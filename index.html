<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸å¯èƒ½ä¸‰è§’ç”Ÿæˆå™¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    #app {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      max-width: 800px;
      width: 100%;
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      font-size: 28px;
    }

    #controls {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 30px;
    }

    .input-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .input-group label {
      min-width: 100px;
      font-weight: 600;
      color: #555;
    }

    input[type="text"] {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 10px;
    }

    button {
      flex: 1;
      padding: 14px 28px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    button:active {
      transform: translateY(0);
    }

    #generate-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    #export-btn {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
    }

    #svg-container {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      background: #fafafa;
      border-radius: 12px;
      padding: 20px;
    }

    svg {
      max-width: 100%;
      height: auto;
    }

    .venn-circle {
      stroke: #333;
      stroke-width: 2.5;
      mix-blend-mode: multiply;
      transition: all 0.3s;
    }

    .venn-circle:hover {
      stroke-width: 3.5;
    }

    .core-label {
      font-size: 18px;
      font-weight: bold;
      fill: #1a1a1a;
      text-anchor: middle;
      cursor: pointer;
      user-select: none;
      transition: all 0.2s;
    }

    .core-label:hover {
      font-size: 20px;
      fill: #667eea;
    }

    .intersection-label {
      font-size: 13px;
      fill: #555;
      text-anchor: middle;
      cursor: pointer;
      user-select: none;
      font-weight: 600;
      transition: all 0.2s;
    }

    .intersection-label:hover {
      fill: #667eea;
      font-weight: bold;
    }

    .intersection-label.empty {
      fill: #999;
      font-style: italic;
      font-size: 12px;
    }

    .intersection-arrow {
      stroke: #666;
      stroke-width: 2;
      stroke-dasharray: 5,3;
      marker-end: url(#arrowhead);
    }

    .hint {
      text-align: center;
      margin-top: 20px;
      color: #888;
      font-size: 14px;
    }

    @media (max-width: 600px) {
      #app {
        padding: 20px;
      }

      h1 {
        font-size: 24px;
      }

      .input-group {
        flex-direction: column;
        align-items: stretch;
      }

      .input-group label {
        min-width: auto;
      }

      .button-group {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h1 style="margin: 0;">ğŸ”º <span id="page-title">ä¸å¯èƒ½ä¸‰è§’ç”Ÿæˆå™¨</span></h1>
      <select id="language-selector" style="padding: 8px 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; cursor: pointer; background: white;">
        <option value="zh-CN">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
        <option value="en">ğŸ‡ºğŸ‡¸ English</option>
        <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
        <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
        <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
        <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
        <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
        <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
        <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
      </select>
    </div>

    <div id="controls">
      <div class="input-group">
        <label id="label-core1">æ ¸å¿ƒæ¦‚å¿µ 1:</label>
        <input type="text" id="core1" placeholder="ä¾‹å¦‚ï¼šå»ä¸­å¿ƒåŒ–">
      </div>
      <div class="input-group">
        <label id="label-core2">æ ¸å¿ƒæ¦‚å¿µ 2:</label>
        <input type="text" id="core2" placeholder="ä¾‹å¦‚ï¼šå®‰å…¨æ€§">
      </div>
      <div class="input-group">
        <label id="label-core3">æ ¸å¿ƒæ¦‚å¿µ 3:</label>
        <input type="text" id="core3" placeholder="ä¾‹å¦‚ï¼šå¯æ‰©å±•æ€§">
      </div>

      <div class="button-group">
        <button id="generate-btn" onclick="generate()"><span id="btn-generate">ç”Ÿæˆä¸‰è§’å›¾</span></button>
        <button id="export-btn" onclick="exportImage()"><span id="btn-export">å¯¼å‡ºä¸ºå›¾ç‰‡</span></button>
      </div>
    </div>

    <div id="svg-container">
      <svg id="venn-diagram" width="600" height="600" viewBox="0 0 600 600">
        <!-- å®šä¹‰æ¸å˜ -->
        <defs>
          <!-- ç®­å¤´æ ‡è®° -->
          <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#666" />
          </marker>

          <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:rgb(255,99,71);stop-opacity:0.6" />
            <stop offset="100%" style="stop-color:rgb(255,150,100);stop-opacity:0.6" />
          </linearGradient>
          <linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:rgb(99,71,255);stop-opacity:0.6" />
            <stop offset="100%" style="stop-color:rgb(150,100,255);stop-opacity:0.6" />
          </linearGradient>
          <linearGradient id="grad3" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:rgb(71,255,99);stop-opacity:0.6" />
            <stop offset="100%" style="stop-color:rgb(100,255,150);stop-opacity:0.6" />
          </linearGradient>
        </defs>

        <!-- ä¸‰ä¸ªåœ†åœˆ -->
        <circle id="circle1" class="venn-circle" fill="url(#grad1)"/>
        <circle id="circle2" class="venn-circle" fill="url(#grad2)"/>
        <circle id="circle3" class="venn-circle" fill="url(#grad3)"/>

        <!-- ç®­å¤´çº¿æ¡ -->
        <line id="arrow-0-1" class="intersection-arrow"/>
        <line id="arrow-1-2" class="intersection-arrow"/>
        <line id="arrow-0-2" class="intersection-arrow"/>

        <!-- æ ¸å¿ƒæ ‡ç­¾ -->
        <text id="label1" class="core-label"></text>
        <text id="label2" class="core-label"></text>
        <text id="label3" class="core-label"></text>

        <!-- äº¤é›†æ ‡ç­¾ï¼ˆå¤–éƒ¨ï¼‰ -->
        <text id="inter-0-1" class="intersection-label"></text>
        <text id="inter-1-2" class="intersection-label"></text>
        <text id="inter-0-2" class="intersection-label"></text>
      </svg>
    </div>

    <p class="hint" id="hint-text">ğŸ’¡ æç¤ºï¼šç‚¹å‡»æ ¸å¿ƒæ¦‚å¿µæˆ–äº¤é›†æ ‡ç­¾ï¼ˆå¸¦ç®­å¤´çš„æ–‡å­—ï¼‰å¯ç¼–è¾‘å†…å®¹</p>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // ========== å›½é™…åŒ–é…ç½® ==========
    const translations = {
      'zh-CN': {
        title: 'ä¸å¯èƒ½ä¸‰è§’ç”Ÿæˆå™¨',
        labelCore1: 'æ ¸å¿ƒæ¦‚å¿µ 1:',
        labelCore2: 'æ ¸å¿ƒæ¦‚å¿µ 2:',
        labelCore3: 'æ ¸å¿ƒæ¦‚å¿µ 3:',
        placeholderCore1: 'ä¾‹å¦‚ï¼šå»ä¸­å¿ƒåŒ–',
        placeholderCore2: 'ä¾‹å¦‚ï¼šå®‰å…¨æ€§',
        placeholderCore3: 'ä¾‹å¦‚ï¼šå¯æ‰©å±•æ€§',
        btnGenerate: 'ç”Ÿæˆä¸‰è§’å›¾',
        btnExport: 'å¯¼å‡ºä¸ºå›¾ç‰‡',
        hint: 'ğŸ’¡ æç¤ºï¼šç‚¹å‡»æ ¸å¿ƒæ¦‚å¿µæˆ–äº¤é›†æ ‡ç­¾ï¼ˆå¸¦ç®­å¤´çš„æ–‡å­—ï¼‰å¯ç¼–è¾‘å†…å®¹',
        defaultCore1: 'å»ä¸­å¿ƒåŒ–',
        defaultCore2: 'å®‰å…¨æ€§',
        defaultCore3: 'å¯æ‰©å±•æ€§',
        defaultConcept: 'æ¦‚å¿µ',
        promptEditCore: 'ç¼–è¾‘æ ¸å¿ƒæ¦‚å¿µ:',
        promptEditInter: 'ç¼–è¾‘äº¤é›†æè¿°:',
        defaultInter01: 'æ¯”ç‰¹å¸',
        defaultInter12: 'è”ç›Ÿé“¾',
        defaultInter02: 'DAGç½‘ç»œ'
      },
      'en': {
        title: 'Impossible Triangle Generator',
        labelCore1: 'Core Concept 1:',
        labelCore2: 'Core Concept 2:',
        labelCore3: 'Core Concept 3:',
        placeholderCore1: 'e.g., Decentralization',
        placeholderCore2: 'e.g., Security',
        placeholderCore3: 'e.g., Scalability',
        btnGenerate: 'Generate Triangle',
        btnExport: 'Export as Image',
        hint: 'ğŸ’¡ Tip: Click on core concepts or intersection labels (with arrows) to edit',
        defaultCore1: 'Decentralization',
        defaultCore2: 'Security',
        defaultCore3: 'Scalability',
        defaultConcept: 'Concept',
        promptEditCore: 'Edit core concept:',
        promptEditInter: 'Edit intersection description:',
        defaultInter01: 'Bitcoin',
        defaultInter12: 'Consortium Chain',
        defaultInter02: 'DAG Network'
      },
      'ja': {
        title: 'ä¸å¯èƒ½ä¸‰è§’å½¢ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼',
        labelCore1: 'ã‚³ã‚¢æ¦‚å¿µ 1:',
        labelCore2: 'ã‚³ã‚¢æ¦‚å¿µ 2:',
        labelCore3: 'ã‚³ã‚¢æ¦‚å¿µ 3:',
        placeholderCore1: 'ä¾‹ï¼šåˆ†æ•£åŒ–',
        placeholderCore2: 'ä¾‹ï¼šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£',
        placeholderCore3: 'ä¾‹ï¼šã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£',
        btnGenerate: 'ä¸‰è§’å½¢ã‚’ç”Ÿæˆ',
        btnExport: 'ç”»åƒã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ',
        hint: 'ğŸ’¡ ãƒ’ãƒ³ãƒˆï¼šã‚³ã‚¢æ¦‚å¿µã¾ãŸã¯äº¤å·®ãƒ©ãƒ™ãƒ«ï¼ˆçŸ¢å°ä»˜ãï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç·¨é›†',
        defaultCore1: 'åˆ†æ•£åŒ–',
        defaultCore2: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£',
        defaultCore3: 'ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£',
        defaultConcept: 'æ¦‚å¿µ',
        promptEditCore: 'ã‚³ã‚¢æ¦‚å¿µã‚’ç·¨é›†:',
        promptEditInter: 'äº¤å·®èª¬æ˜ã‚’ç·¨é›†:',
        defaultInter01: 'ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³',
        defaultInter12: 'ã‚³ãƒ³ã‚½ãƒ¼ã‚·ã‚¢ãƒ ãƒã‚§ãƒ¼ãƒ³',
        defaultInter02: 'DAGãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯'
      },
      'ko': {
        title: 'ë¶ˆê°€ëŠ¥í•œ ì‚¼ê°í˜• ìƒì„±ê¸°',
        labelCore1: 'í•µì‹¬ ê°œë… 1:',
        labelCore2: 'í•µì‹¬ ê°œë… 2:',
        labelCore3: 'í•µì‹¬ ê°œë… 3:',
        placeholderCore1: 'ì˜ˆ: íƒˆì¤‘ì•™í™”',
        placeholderCore2: 'ì˜ˆ: ë³´ì•ˆ',
        placeholderCore3: 'ì˜ˆ: í™•ì¥ì„±',
        btnGenerate: 'ì‚¼ê°í˜• ìƒì„±',
        btnExport: 'ì´ë¯¸ì§€ë¡œ ë‚´ë³´ë‚´ê¸°',
        hint: 'ğŸ’¡ íŒ: í•µì‹¬ ê°œë… ë˜ëŠ” êµì°¨ ë¼ë²¨(í™”ì‚´í‘œ í¬í•¨)ì„ í´ë¦­í•˜ì—¬ í¸ì§‘',
        defaultCore1: 'íƒˆì¤‘ì•™í™”',
        defaultCore2: 'ë³´ì•ˆ',
        defaultCore3: 'í™•ì¥ì„±',
        defaultConcept: 'ê°œë…',
        promptEditCore: 'í•µì‹¬ ê°œë… í¸ì§‘:',
        promptEditInter: 'êµì°¨ ì„¤ëª… í¸ì§‘:',
        defaultInter01: 'ë¹„íŠ¸ì½”ì¸',
        defaultInter12: 'ì»¨ì†Œì‹œì—„ ì²´ì¸',
        defaultInter02: 'DAG ë„¤íŠ¸ì›Œí¬'
      },
      'es': {
        title: 'Generador de TriÃ¡ngulo Imposible',
        labelCore1: 'Concepto Central 1:',
        labelCore2: 'Concepto Central 2:',
        labelCore3: 'Concepto Central 3:',
        placeholderCore1: 'ej., DescentralizaciÃ³n',
        placeholderCore2: 'ej., Seguridad',
        placeholderCore3: 'ej., Escalabilidad',
        btnGenerate: 'Generar TriÃ¡ngulo',
        btnExport: 'Exportar como Imagen',
        hint: 'ğŸ’¡ Consejo: Haz clic en conceptos centrales o etiquetas de intersecciÃ³n (con flechas) para editar',
        defaultCore1: 'DescentralizaciÃ³n',
        defaultCore2: 'Seguridad',
        defaultCore3: 'Escalabilidad',
        defaultConcept: 'Concepto',
        promptEditCore: 'Editar concepto central:',
        promptEditInter: 'Editar descripciÃ³n de intersecciÃ³n:',
        defaultInter01: 'Bitcoin',
        defaultInter12: 'Cadena de Consorcio',
        defaultInter02: 'Red DAG'
      },
      'fr': {
        title: 'GÃ©nÃ©rateur de Triangle Impossible',
        labelCore1: 'Concept Central 1:',
        labelCore2: 'Concept Central 2:',
        labelCore3: 'Concept Central 3:',
        placeholderCore1: 'ex., DÃ©centralisation',
        placeholderCore2: 'ex., SÃ©curitÃ©',
        placeholderCore3: 'ex., Ã‰volutivitÃ©',
        btnGenerate: 'GÃ©nÃ©rer le Triangle',
        btnExport: 'Exporter en Image',
        hint: 'ğŸ’¡ Astuce: Cliquez sur les concepts centraux ou les Ã©tiquettes d\'intersection (avec flÃ¨ches) pour Ã©diter',
        defaultCore1: 'DÃ©centralisation',
        defaultCore2: 'SÃ©curitÃ©',
        defaultCore3: 'Ã‰volutivitÃ©',
        defaultConcept: 'Concept',
        promptEditCore: 'Modifier le concept central:',
        promptEditInter: 'Modifier la description de l\'intersection:',
        defaultInter01: 'Bitcoin',
        defaultInter12: 'ChaÃ®ne de Consortium',
        defaultInter02: 'RÃ©seau DAG'
      },
      'de': {
        title: 'UnmÃ¶gliches Dreieck Generator',
        labelCore1: 'Kernkonzept 1:',
        labelCore2: 'Kernkonzept 2:',
        labelCore3: 'Kernkonzept 3:',
        placeholderCore1: 'z.B. Dezentralisierung',
        placeholderCore2: 'z.B. Sicherheit',
        placeholderCore3: 'z.B. Skalierbarkeit',
        btnGenerate: 'Dreieck Generieren',
        btnExport: 'Als Bild Exportieren',
        hint: 'ğŸ’¡ Tipp: Klicken Sie auf Kernkonzepte oder Schnittstellen-Labels (mit Pfeilen) zum Bearbeiten',
        defaultCore1: 'Dezentralisierung',
        defaultCore2: 'Sicherheit',
        defaultCore3: 'Skalierbarkeit',
        defaultConcept: 'Konzept',
        promptEditCore: 'Kernkonzept bearbeiten:',
        promptEditInter: 'Schnittstellenbeschreibung bearbeiten:',
        defaultInter01: 'Bitcoin',
        defaultInter12: 'Konsortium-Chain',
        defaultInter02: 'DAG-Netzwerk'
      },
      'ru': {
        title: 'Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾Ğ³Ğ¾ Ğ¢Ñ€ĞµÑƒĞ³Ğ¾Ğ»ÑŒĞ½Ğ¸ĞºĞ°',
        labelCore1: 'ĞšĞ»ÑÑ‡ĞµĞ²Ğ°Ñ ĞšĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ñ 1:',
        labelCore2: 'ĞšĞ»ÑÑ‡ĞµĞ²Ğ°Ñ ĞšĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ñ 2:',
        labelCore3: 'ĞšĞ»ÑÑ‡ĞµĞ²Ğ°Ñ ĞšĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ñ 3:',
        placeholderCore1: 'Ğ½Ğ°Ğ¿Ñ€., Ğ”ĞµÑ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ',
        placeholderCore2: 'Ğ½Ğ°Ğ¿Ñ€., Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ',
        placeholderCore3: 'Ğ½Ğ°Ğ¿Ñ€., ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ',
        btnGenerate: 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¢Ñ€ĞµÑƒĞ³Ğ¾Ğ»ÑŒĞ½Ğ¸Ğº',
        btnExport: 'Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ² Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ',
        hint: 'ğŸ’¡ Ğ¡Ğ¾Ğ²ĞµÑ‚: ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ½Ğ° ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ĞºĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ğ¸ Ğ¸Ğ»Ğ¸ Ğ¼ĞµÑ‚ĞºĞ¸ Ğ¿ĞµÑ€ĞµÑĞµÑ‡ĞµĞ½Ğ¸Ğ¹ (ÑĞ¾ ÑÑ‚Ñ€ĞµĞ»ĞºĞ°Ğ¼Ğ¸) Ğ´Ğ»Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ',
        defaultCore1: 'Ğ”ĞµÑ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ',
        defaultCore2: 'Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ',
        defaultCore3: 'ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ',
        defaultConcept: 'ĞšĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ñ',
        promptEditCore: 'Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ»ÑÑ‡ĞµĞ²ÑƒÑ ĞºĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ñ:',
        promptEditInter: 'Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµÑĞµÑ‡ĞµĞ½Ğ¸Ñ:',
        defaultInter01: 'Ğ‘Ğ¸Ñ‚ĞºĞ¾Ğ¹Ğ½',
        defaultInter12: 'ĞšĞ¾Ğ½ÑĞ¾Ñ€Ñ†Ğ¸ÑƒĞ¼-Ñ†ĞµĞ¿ÑŒ',
        defaultInter02: 'DAG-ÑĞµÑ‚ÑŒ'
      },
      'pt': {
        title: 'Gerador de TriÃ¢ngulo ImpossÃ­vel',
        labelCore1: 'Conceito Central 1:',
        labelCore2: 'Conceito Central 2:',
        labelCore3: 'Conceito Central 3:',
        placeholderCore1: 'ex., DescentralizaÃ§Ã£o',
        placeholderCore2: 'ex., SeguranÃ§a',
        placeholderCore3: 'ex., Escalabilidade',
        btnGenerate: 'Gerar TriÃ¢ngulo',
        btnExport: 'Exportar como Imagem',
        hint: 'ğŸ’¡ Dica: Clique nos conceitos centrais ou rÃ³tulos de interseÃ§Ã£o (com setas) para editar',
        defaultCore1: 'DescentralizaÃ§Ã£o',
        defaultCore2: 'SeguranÃ§a',
        defaultCore3: 'Escalabilidade',
        defaultConcept: 'Concepto',
        promptEditCore: 'Editar conceito central:',
        promptEditInter: 'Editar descriÃ§Ã£o de interseÃ§Ã£o:',
        defaultInter01: 'Bitcoin',
        defaultInter12: 'Cadeia de ConsÃ³rcio',
        defaultInter02: 'Rede DAG'
      }
    };

    // å½“å‰è¯­è¨€ï¼ˆé»˜è®¤è‹±æ–‡ï¼Œåç»­ä¼šæ£€æµ‹ï¼‰
    let currentLanguage = 'en';

    // æ£€æµ‹æµè§ˆå™¨è¯­è¨€
    function detectLanguage() {
      // ä¼˜å…ˆä½¿ç”¨ localStorage ä¿å­˜çš„è¯­è¨€
      const savedLang = localStorage.getItem('preferredLanguage');
      if (savedLang && translations[savedLang]) {
        return savedLang;
      }

      // æ£€æµ‹æµè§ˆå™¨è¯­è¨€
      const browserLang = navigator.language || navigator.userLanguage;

      // ç²¾ç¡®åŒ¹é…ï¼ˆå¦‚ zh-CNï¼‰
      if (translations[browserLang]) {
        return browserLang;
      }

      // æ¨¡ç³ŠåŒ¹é…ï¼ˆå¦‚ zh åŒ¹é… zh-CNï¼‰
      const langPrefix = browserLang.split('-')[0];
      for (const key in translations) {
        if (key.startsWith(langPrefix)) {
          return key;
        }
      }

      // å›é€€åˆ°è‹±æ–‡
      return 'en';
    }

    // åˆ‡æ¢è¯­è¨€
    function switchLanguage(lang) {
      if (!translations[lang]) {
        lang = 'en'; // å›é€€åˆ°è‹±æ–‡
      }

      currentLanguage = lang;
      localStorage.setItem('preferredLanguage', lang);

      // æ›´æ–°ç•Œé¢
      const t = translations[lang];
      document.getElementById('page-title').textContent = t.title;
      document.getElementById('label-core1').textContent = t.labelCore1;
      document.getElementById('label-core2').textContent = t.labelCore2;
      document.getElementById('label-core3').textContent = t.labelCore3;
      document.getElementById('core1').placeholder = t.placeholderCore1;
      document.getElementById('core2').placeholder = t.placeholderCore2;
      document.getElementById('core3').placeholder = t.placeholderCore3;
      document.getElementById('btn-generate').textContent = t.btnGenerate;
      document.getElementById('btn-export').textContent = t.btnExport;
      document.getElementById('hint-text').textContent = t.hint;
      document.getElementById('language-selector').value = lang;

      // æ›´æ–° HTML lang å±æ€§
      document.documentElement.lang = lang;
    }

    // ========== åŸæœ‰ä»£ç  ==========
    // æ•°æ®ç»“æ„ - Linus å¼ç®€æ´
    const state = {
      cores: ['', '', ''],
      intersections: ['', '', '']
    };

    // è®¡ç®—åœ†åœˆä½ç½® - æ•°å­¦é©±åŠ¨ï¼Œé›¶ç‰¹æ®Šæƒ…å†µ
    function calculatePositions() {
      const centerX = 300;
      const centerY = 300;
      const radius = 120;
      const distance = 125; // åœ†å¿ƒè·ä¸­å¿ƒçš„è·ç¦»ï¼ˆè°ƒæ•´ä¸º 125ï¼Œæ¶ˆé™¤ä¸‰åœ†å…±äº¤ï¼‰

      // ä¸‰ä¸ªè§’åº¦ï¼š90Â°ï¼ˆé¡¶éƒ¨ï¼‰, 210Â°ï¼ˆå·¦ä¸‹ï¼‰, 330Â°ï¼ˆå³ä¸‹ï¼‰
      const angles = [90, 210, 330];

      return angles.map((angle, i) => {
        const radian = (angle * Math.PI) / 180;
        const cx = centerX + distance * Math.cos(radian);
        const cy = centerY - distance * Math.sin(radian);
        return {
          cx: cx,
          cy: cy,
          labelX: cx, // æ ‡ç­¾æ”¾åœ¨åœ†å¿ƒ
          labelY: cy  // æ ‡ç­¾æ”¾åœ¨åœ†å¿ƒ
        };
      });
    }

    // è®¡ç®—ä¸¤åœ†äº¤ç‚¹ - æ•°å­¦ç›´æ¥è§£
    function getCircleIntersections(x1, y1, r1, x2, y2, r2) {
      const d = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
      if (d > r1 + r2 || d < Math.abs(r1 - r2)) return null; // æ— äº¤ç‚¹

      const a = (r1 ** 2 - r2 ** 2 + d ** 2) / (2 * d);
      const h = Math.sqrt(r1 ** 2 - a ** 2);

      const px = x1 + a * (x2 - x1) / d;
      const py = y1 + a * (y2 - y1) / d;

      const offsetX = h * (y2 - y1) / d;
      const offsetY = h * (x2 - x1) / d;

      return {
        p1: { x: px + offsetX, y: py - offsetY },
        p2: { x: px - offsetX, y: py + offsetY }
      };
    }

    // è®¡ç®—äº¤é›†æ ‡ç­¾ä½ç½®å’Œç®­å¤´
    function calculateIntersectionPositions() {
      const centerX = 300;
      const centerY = 300;
      const positions = calculatePositions();
      const radius = 120;

      // è®¡ç®—æ¯å¯¹åœ†çš„äº¤ç‚¹
      const inter01 = getCircleIntersections(
        positions[0].cx, positions[0].cy, radius,
        positions[1].cx, positions[1].cy, radius
      );
      const inter12 = getCircleIntersections(
        positions[1].cx, positions[1].cy, radius,
        positions[2].cx, positions[2].cy, radius
      );
      const inter02 = getCircleIntersections(
        positions[0].cx, positions[0].cy, radius,
        positions[2].cx, positions[2].cy, radius
      );

      // è®¡ç®—ä»ç›¸äº¤åŒºåŸŸä¸­ç‚¹å‘å¤–å»¶ä¼¸çš„ç®­å¤´
      const calculateArrowFromIntersection = (inter, labelOffsetY = 0) => {
        // ä¸¤äº¤ç‚¹çš„ä¸­ç‚¹
        const midX = (inter.p1.x + inter.p2.x) / 2;
        const midY = (inter.p1.y + inter.p2.y) / 2;

        // ä»ä¸‰è§’å½¢ä¸­å¿ƒæŒ‡å‘ä¸­ç‚¹çš„æ–¹å‘
        const dx = midX - centerX;
        const dy = midY - centerY;
        const len = Math.sqrt(dx * dx + dy * dy);
        const ndx = dx / len;
        const ndy = dy / len;

        // å…ˆå‘å¤–ç§»åŠ¨ä¸€æ®µè·ç¦»ï¼Œè®©ç®­å¤´èµ·ç‚¹ç¦»åœ†æœ‰è·ç¦»
        const offsetDist = 80;
        const arrowStartX = midX + ndx * offsetDist;
        const arrowStartY = midY + ndy * offsetDist;

        // ç®­å¤´é•¿åº¦
        const extendDist = 100;
        const arrowEndX = arrowStartX + ndx * extendDist;
        const arrowEndY = arrowStartY + ndy * extendDist;

        // æ ‡ç­¾åœ¨ç®­å¤´ç»ˆç‚¹å¤–å†åç§»ä¸€æ®µè·ç¦»
        const labelGap = 15;  // æ ‡ç­¾ä¸ç®­å¤´ç»ˆç‚¹çš„é—´è·ï¼ˆç¼©å°åˆ°15ï¼‰
        const labelX = arrowEndX + ndx * labelGap;
        const labelY = arrowEndY + ndy * labelGap;

        return {
          arrowStart: { x: arrowStartX, y: arrowStartY },
          arrowEnd: { x: arrowEndX, y: arrowEndY },
          label: { x: labelX, y: labelY + labelOffsetY }
        };
      };

      return [
        calculateArrowFromIntersection(inter01),      // å·¦ä¾§
        calculateArrowFromIntersection(inter12, 20),  // åº•éƒ¨ - æ ‡ç­¾å‘ä¸‹åç§»20px
        calculateArrowFromIntersection(inter02)       // å³ä¾§
      ];
    }

    // ç”Ÿæˆä¸‰è§’å›¾ - å•ä¸€æ•°æ®æµ
    function generate() {
      const t = translations[currentLanguage];

      // è¯»å–è¾“å…¥
      state.cores = [
        document.getElementById('core1').value || `${t.defaultConcept} A`,
        document.getElementById('core2').value || `${t.defaultConcept} B`,
        document.getElementById('core3').value || `${t.defaultConcept} C`
      ];

      const positions = calculatePositions();
      const radius = 120;

      // ç»˜åˆ¶åœ†åœˆ - ç”¨å¾ªç¯ï¼Œä¸æ˜¯ if/else
      positions.forEach((pos, i) => {
        const circle = document.getElementById(`circle${i + 1}`);
        circle.setAttribute('cx', pos.cx);
        circle.setAttribute('cy', pos.cy);
        circle.setAttribute('r', radius);
      });

      // ç»˜åˆ¶æ ¸å¿ƒæ ‡ç­¾
      positions.forEach((pos, i) => {
        const label = document.getElementById(`label${i + 1}`);
        label.setAttribute('x', pos.labelX);
        label.setAttribute('y', pos.labelY);
        label.textContent = state.cores[i];

        // æ·»åŠ ç‚¹å‡»ç¼–è¾‘
        label.onclick = function() {
          editLabel(i, 'core');
        };
      });

      // ç»˜åˆ¶äº¤é›†æ ‡ç­¾å’Œç®­å¤´
      const interPositions = calculateIntersectionPositions();
      const interLabels = [t.defaultInter01, t.defaultInter12, t.defaultInter02]; // ä»ç¿»è¯‘è¯»å–é»˜è®¤å€¼

      interPositions.forEach((pos, i) => {
        const labelId = i === 0 ? 'inter-0-1' : i === 1 ? 'inter-1-2' : 'inter-0-2';
        const arrowId = i === 0 ? 'arrow-0-1' : i === 1 ? 'arrow-1-2' : 'arrow-0-2';
        const text = state.intersections[i] || interLabels[i];

        // ç»˜åˆ¶å¤–éƒ¨æ ‡ç­¾ - åœ¨å»¶é•¿çº¿ä¸Š
        const label = document.getElementById(labelId);
        label.setAttribute('x', pos.label.x);
        label.setAttribute('y', pos.label.y);
        label.textContent = text;

        // æ ‡è®°ç©ºçŠ¶æ€ - åªæœ‰å½“æ–‡æœ¬æ˜¯å ä½ç¬¦æ—¶æ‰æ ‡è®°
        if (text === 'â€”') {
          label.classList.add('empty');
        } else {
          label.classList.remove('empty');
        }

        // ç»˜åˆ¶ç®­å¤´ - å®Œå…¨åœ¨å»¶é•¿çº¿ä¸Š
        const arrow = document.getElementById(arrowId);
        arrow.setAttribute('x1', pos.arrowStart.x);
        arrow.setAttribute('y1', pos.arrowStart.y);
        arrow.setAttribute('x2', pos.arrowEnd.x);
        arrow.setAttribute('y2', pos.arrowEnd.y);

        // æ·»åŠ ç‚¹å‡»ç¼–è¾‘
        label.onclick = function() {
          editLabel(i, 'intersection');
        };
      });
    }

    // ç¼–è¾‘æ ‡ç­¾ - æœ€ç®€äº¤äº’
    function editLabel(index, type) {
      const t = translations[currentLanguage];
      const current = type === 'core' ? state.cores[index] : state.intersections[index];
      const prompt_text = type === 'core' ? t.promptEditCore : t.promptEditInter;

      const newText = prompt(prompt_text, current === 'â€”' ? '' : current);

      if (newText !== null) {
        if (type === 'core') {
          if (newText.trim() === '') return; // æ ¸å¿ƒæ¦‚å¿µä¸èƒ½ä¸ºç©º
          state.cores[index] = newText;
          document.getElementById(`label${index + 1}`).textContent = newText;
          // åŒæ­¥æ›´æ–°è¾“å…¥æ¡†
          document.getElementById(`core${index + 1}`).value = newText;
        } else {
          // æ›´æ–°äº¤é›†æ ‡ç­¾
          state.intersections[index] = newText.trim();
          const labelId = index === 0 ? 'inter-0-1' : index === 1 ? 'inter-1-2' : 'inter-0-2';
          const label = document.getElementById(labelId);

          if (newText.trim() === '') {
            label.textContent = 'â€”';
            label.classList.add('empty');
          } else {
            label.textContent = newText.trim();
            label.classList.remove('empty');
          }
        }
      }
    }

    // å¯¼å‡ºå›¾ç‰‡ - å®ç”¨ä¸»ä¹‰
    function exportImage() {
      const container = document.getElementById('svg-container');

      html2canvas(container, {
        backgroundColor: '#ffffff',
        scale: 2,
        logging: false
      }).then(canvas => {
        canvas.toBlob(blob => {
          // ä¸‹è½½æ–‡ä»¶
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `impossible-triangle-${Date.now()}.png`;
          link.click();
          URL.revokeObjectURL(url);

          // å¤åˆ¶åˆ°å‰ªè´´æ¿
          if (navigator.clipboard && ClipboardItem) {
            navigator.clipboard.write([
              new ClipboardItem({ 'image/png': blob })
            ]);
          }
        });
      });
    }

    // é¡µé¢åŠ è½½æ—¶ç”Ÿæˆé»˜è®¤ç¤ºä¾‹
    window.addEventListener('load', function() {
      // åˆå§‹åŒ–è¯­è¨€
      currentLanguage = detectLanguage();
      switchLanguage(currentLanguage);

      // ä½¿ç”¨å½“å‰è¯­è¨€çš„é»˜è®¤å€¼
      const t = translations[currentLanguage];
      document.getElementById('core1').value = t.defaultCore1;
      document.getElementById('core2').value = t.defaultCore2;
      document.getElementById('core3').value = t.defaultCore3;

      generate();
    });

    // è¯­è¨€é€‰æ‹©å™¨äº‹ä»¶ç›‘å¬
    document.getElementById('language-selector').addEventListener('change', function(e) {
      switchLanguage(e.target.value);

      // å¦‚æœè¾“å…¥æ¡†è¿˜æ˜¯é»˜è®¤å€¼ï¼Œåˆ‡æ¢åˆ°æ–°è¯­è¨€çš„é»˜è®¤å€¼
      const oldT = translations[currentLanguage === e.target.value ? currentLanguage : Object.keys(translations).find(k => k !== e.target.value)];
      const newT = translations[e.target.value];

      // æ£€æŸ¥æ˜¯å¦æ˜¯é»˜è®¤å€¼ï¼Œå¦‚æœæ˜¯åˆ™æ›´æ–°
      const core1 = document.getElementById('core1').value;
      const core2 = document.getElementById('core2').value;
      const core3 = document.getElementById('core3').value;

      // ç®€åŒ–é€»è¾‘ï¼šåªåœ¨è¾“å…¥æ¡†ä¸ºç©ºæˆ–ä¸ºä»»ä½•è¯­è¨€çš„é»˜è®¤å€¼æ—¶æ›´æ–°
      const isDefault1 = !core1 || Object.values(translations).some(t => t.defaultCore1 === core1);
      const isDefault2 = !core2 || Object.values(translations).some(t => t.defaultCore2 === core2);
      const isDefault3 = !core3 || Object.values(translations).some(t => t.defaultCore3 === core3);

      if (isDefault1) document.getElementById('core1').value = newT.defaultCore1;
      if (isDefault2) document.getElementById('core2').value = newT.defaultCore2;
      if (isDefault3) document.getElementById('core3').value = newT.defaultCore3;

      generate();
    });

    // å›è½¦é”®å¿«é€Ÿç”Ÿæˆ
    document.querySelectorAll('input[type="text"]').forEach(input => {
      input.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          generate();
        }
      });
    });
  </script>
</body>
</html>
